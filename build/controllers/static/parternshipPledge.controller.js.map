{"version":3,"sources":["../../../src/controllers/static/parternshipPledge.controller.js"],"names":["PartnershipPledgeController","req","res","GivingCategory","find","then","givingCategories","Member","populate","members","Partnership","partnerships","status","render","title","datespan","body","trim","split","formatter","getMonthRange","start","end","searcher","partnershipByDateSpan","pledges","total","calculator","findTotal","startDate","Date","endDate","totalAmount","memberId","params","partnershipByMember","member","firstname","lastname","Giving","createOn","$gte","$lte","console","log","partnership","amount","pledge","PartnershipPledge","save","result","redirect","err","giving","givings"],"mappings":"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","sourcesContent":["import PartnershipPledge from \"../../models/partnership_pledge.model\";\nimport Partnership from \"../../models/partnership.model\";\nimport Member from \"../../models/member.model\";\nimport GivingCategory from \"../../models/giving_category.model\";\nimport Giving from \"../../models/giving.model\";\nimport formatter from \"../../helpers/formatters\";\nimport calculator from \"../../helpers/calculator\";\nimport searcher from \"../../helpers/searchers\";\n\nimport moment from \"moment\";\n\nclass PartnershipPledgeController {\n  static getAddPartnershipPledgePage(req, res) {\n    GivingCategory.find().then(givingCategories => {\n      Member.find()\n        .populate(\"fellowship\")\n        .then(members => {\n          Partnership.find().then(partnerships => {\n            res.status(201).render(\"admin/pledges-add\", {\n              partnerships: partnerships,\n              members: members,\n              givingCategories: givingCategories,\n              title: \"Pledges\"\n            });\n          });\n        });\n    });\n  }\n\n  static getDatedPartnershipPledges(req, res) {\n    const datespan = req.body.datespan.trim().split(\" - \");\n    const { start, end } = formatter.getMonthRange(datespan[0], datespan[1]);\n    searcher.partnershipByDateSpan(start, end).then(pledges => {\n      const total = calculator.findTotal(pledges);\n      res.status(201).render(\"admin/all-partnerships\", {\n        pledges: pledges,\n        title: \"All Partnership Record\",\n        startDate: new Date(start),\n        endDate: new Date(end),\n        totalAmount: total\n      });\n    });\n  }\n\n  static getMemberPartnerships(req, res) {\n    const { start, end } = formatter.getMonthRange();\n    const memberId = req.params.memberId;\n    searcher.partnershipByMember(memberId, start, end).then(pledges => {\n      const total = calculator.findTotal(pledges);\n      res.status(201).render(\"admin/member-partnerships\", {\n        pledges: pledges,\n        title:\n          \"Partnership Record Of \" +\n          pledges[0].member.firstname +\n          \" \" +\n          pledges[0].member.lastname,\n        startDate: new Date(start),\n        endDate: new Date(end),\n        totalAmount: total\n      });\n    });\n  }\n\n  static getPartnershipPledges(req, res) {\n    const { start, end } = formatter.getMonthRange();\n    searcher.partnershipByDateSpan(start, end).then(pledges => {\n      const total = calculator.findTotal(pledges);\n      res.status(201).render(\"admin/all-partnerships\", {\n        pledges: pledges,\n        title: \"All Partnership Pledges Record\",\n        startDate: new Date(start),\n        endDate: new Date(end),\n        totalAmount: total\n      });\n    });\n  }\n\n  static getGivings(req, res) {\n    const { start, end } = formatter.getMonthRange();\n    Giving.find({ createOn: { $gte: start, $lte: end } })\n      .populate(\"member\")\n      .populate(\"giving\")\n      .then(pledges => {\n        console.log(calculator.findTotal(pledges));\n        res.status(201).render(\"admin/all-givings\", {\n          pledges: pledges,\n          title: \"All Giving Records\"\n        });\n      });\n  }\n\n  static savePartnershipPledge(req, res) {\n    let { partnership, member, amount } = req.body;\n    const pledge = new PartnershipPledge({\n      partnership: partnership,\n      member: member,\n      amount,\n      amount\n    });\n    pledge\n      .save()\n      .then(result => res.redirect(\"/admin/pledges/partnerships\"))\n      .catch(err => {\n        console.log(err);\n      });\n  }\n\n  static saveGiving(req, res) {\n    let { giving, member, amount } = req.body;\n    const givings = new Giving({\n      giving: giving,\n      member: member,\n      amount: amount\n    });\n    givings\n      .save()\n      .then(result => res.redirect(\"/admin/pledges/\"))\n      .catch(err => {\n        console.log(err);\n      });\n  }\n}\n\nexport default PartnershipPledgeController;\n"],"file":"parternshipPledge.controller.js"}